(function(e){function t(t){for(var r,c,s=t[0],i=t[1],u=t[2],l=0,m=[];l<s.length;l++)c=s[l],Object.prototype.hasOwnProperty.call(o,c)&&o[c]&&m.push(o[c][0]),o[c]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);d&&d(t);while(m.length)m.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,c=1;c<n.length;c++){var i=n[c];0!==o[i]&&(r=!1)}r&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={"app~d0ae3f07":0},a=[];function c(e){return s.p+"js/"+({"about~6a3582c1":"about~6a3582c1"}[e]||e)+"."+{"about~6a3582c1":"e67860e2"}[e]+".js"}function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n=o[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=o[e]=[t,r]}));t.push(n[2]=r);var a,i=document.createElement("script");i.charset="utf-8",i.timeout=120,s.nc&&i.setAttribute("nonce",s.nc),i.src=c(e);var u=new Error;a=function(t){i.onerror=i.onload=null,clearTimeout(l);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",u.name="ChunkLoadError",u.type=r,u.request=a,n[1](u)}o[e]=void 0}};var l=setTimeout((function(){a({type:"timeout",target:i})}),12e4);i.onerror=i.onload=a,document.head.appendChild(i)}return Promise.all(t)},s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var d=u;a.push([0,"chunk-vendors~9c3c11b1","chunk-vendors~2a42e354","chunk-vendors~d21988b8","chunk-vendors~b5906859","chunk-vendors~b58f7129","chunk-vendors~fdc6512a","chunk-vendors~0605657e","chunk-vendors~d2305125","chunk-vendors~4a7e9e0b","chunk-vendors~dde583c9","chunk-vendors~ca4597b0"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{attrs:{id:"nav"}},[n("router-link",{attrs:{to:"/"}},[e._v("Home")]),e._v(" | "),n("router-link",{attrs:{to:"/about"}},[e._v("About")]),e._v(" | "),n("router-link",{attrs:{to:"/video-chat"}},[e._v("Video Chat (test)")])],1),n("v-main",{staticClass:"mx-5 mb-5 mt-2"},[n("router-view")],1)],1)},a=[],c={data:function(){return{}},methods:{},created:function(){}},s=c,i=(n("034f"),n("2877")),u=n("6544"),l=n.n(u),d=n("f6c4"),m=Object(i["a"])(s,o,a,!1,null,null,null),f=m.exports;l()(m,{VMain:d["a"]});n("d3b7"),n("3ca3"),n("ddb0");var p=n("8c4f"),v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("v-list",{attrs:{dense:""}},e._l(e.rooms,(function(t){return n("v-list-item",{key:t,attrs:{router:"",to:"/room/"+t}},[n("v-list-item-action",[n("v-icon",{attrs:{color:"white"}},[e._v("mdi-plus")])],1),n("v-list-item-content",[n("v-list-item-title",{staticClass:"white--text caption"},[e._v(" "+e._s(t)+" ")])],1)],1)})),1),n("v-text-field",{model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),n("v-btn",{on:{click:e.setUsername}},[e._v("Set username")])],1)},h=[],g=n("1da1"),k=(n("96cf"),n("8e27")),b=n.n(k),w={name:"Home",data:function(){return{socket:null,rooms:[],username:null}},methods:{setUsername:function(){console.log("Setting username: "+this.username),this.$store.commit("setUsername",this.username)}},created:function(){var e=this;this.socket=b()("https://video-chat3.herokuapp.com/"),this.socket.on("rooms",function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.rooms=n;case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.socket.emit("get-rooms")},destroyed:function(){this.socket.off("rooms")},components:{}},x=w,y=n("8336"),C=n("132d"),R=n("8860"),S=n("da13"),j=n("1800"),O=n("5d23"),_=n("8654"),T=Object(i["a"])(x,v,h,!1,null,"49b95f5d",null),V=T.exports;l()(T,{VBtn:y["a"],VIcon:C["a"],VList:R["a"],VListItem:S["a"],VListItemAction:j["a"],VListItemContent:O["a"],VListItemTitle:O["b"],VTextField:_["a"]});var L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("video",{attrs:{autoplay:"",playsinline:"",controls:"false"},domProps:{srcObject:e.videoStream}}),n("video",{attrs:{autoplay:"",playsinline:"",controls:"false"},domProps:{srcObject:e.remoteVideoStream}}),n("button",{on:{click:e.makeCall}},[e._v("Make call")])])},$=[],D=(n("159b"),n("bc3a")),E=n.n(D),I=function(){return console.log("https://video-chat3.herokuapp.com/"),E.a.create({baseURL:"https://video-chat3.herokuapp.com/"})},U={test:function(){return I().get("/test")}},M=n("b225"),P=n.n(M),A={name:"Home",data:function(){return{constraints:{video:!0,audio:!0},videoStream:null,remoteVideoStream:null,iceCandidates:[],iceConfiguration:{iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:157.230.117.185:3478"],username:"tonesija",credential:"111111222"}]},pc:null}},sockets:{message:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.offer){e.next=11;break}return console.log("Got an offer"),this.pc.setRemoteDescription(new RTCSessionDescription(t.offer)),e.next=5,this.pc.createAnswer();case 5:return n=e.sent,e.next=8,this.pc.setLocalDescription(n);case 8:this.$socket.emit("answer",n),e.next=22;break;case 11:if(!t.iceCandidate){e.next=22;break}return console.log("Got and ice candidate through message"),e.prev=13,console.log("Addin ice candidate to peer connection"),e.next=17,this.pc.addIceCandidate(t.iceCandidate);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](13),console.error("Error adding received ice candidate",e.t0);case 22:case"end":return e.stop()}}),e,this,[[13,19]])})));function t(t){return e.apply(this,arguments)}return t}()},methods:{makeCall:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Making call"),e.$socket.$subscribe("message",function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n.answer){t.next=5;break}return console.log("Got an answer"),r=new RTCSessionDescription(n.answer),t.next=5,e.pc.setRemoteDescription(r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n={offerToReceiveAudio:!0,offerToReceiveVideo:!0},t.next=5,e.pc.createOffer(n);case 5:return r=t.sent,t.next=8,e.pc.setLocalDescription(r);case 8:e.$socket.client.emit("offer",r);case 9:case"end":return t.stop()}}),t)})))()}},created:function(){var e=this;navigator.mediaDevices.getUserMedia(this.constraints).then((function(t){console.log("Got MediaStream:",t),e.videoStream=t,e.videoStream.getTracks().forEach((function(t){e.pc.addTrack(t,e.videoStream),console.log("Adding track to peer connection!")}))})).catch((function(e){console.error("Error accessing media devices.",e)})),this.pc=new RTCPeerConnection(this.iceConfiguration),P.a.onMessageOffer(this.pc,this.$socket.client),P.a.onIceCandidate(this.pc,this.$socket.client),P.a.oneIceConnectionChange(this.pc),this.remoteVideoStream=new MediaStream,P.a.onTrack(this.pc,this.remoteVideoStream)},mounted:function(){U.test().then((function(e){console.log("Test results: ",e.data)})).catch((function(e){console.log("Test error: ",e)}))},destroyed:function(){this.$socket.$unsubscribe("message")}},G=A,H=Object(i["a"])(G,L,$,!1,null,"1cbd205f",null),J=H.exports,N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"room"},[n("h1",[e._v(e._s(e.$route.params.roomName))]),n("v-btn",{on:{click:e.joinCall}},[e._v("Join call")]),e.inCall?n("video",{attrs:{autoplay:"",playsinline:"",controls:"false"},domProps:{srcObject:e.videoStream}}):e._e(),e.inCall?n("div",e._l(e.remoteVideoStreams,(function(e){return n("video",{key:e.username,attrs:{autoplay:"",playsinline:"",controls:"false"},domProps:{srcObject:e.mediaStream}})})),0):e._e(),n("v-list",{attrs:{dense:""}},e._l(e.users,(function(t){return n("v-list-item",{key:t.id},[n("v-list-item-action",[n("v-icon",{attrs:{color:"white"}},[e._v("mdi-plus")])],1),n("v-list-item-content",[n("v-list-item-title",{staticClass:"white--text caption"},[e._v(" "+e._s(t.username)+" ")])],1)],1)})),1)],1)},B=[],q=n("b85c"),F=(n("4ec9"),{name:"Home",data:function(){return{localUsername:null,users:[],pcs:null,room:null,constraints:{video:!0,audio:!0},videoStream:null,inCall:!1,remoteVideoStreams:[],iceConfiguration:{iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:157.230.117.185:3478"],username:"tonesija",credential:"111111222"}]}}},methods:{joinCall:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,r,o,a,c,s,i,u,l,d,m,f,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.pcs=new Map,n=Object(q["a"])(e.users);try{for(n.s();!(r=n.n()).done;)o=r.value,o.username!=e.localUsername&&e.pcs.set(o.username,new RTCPeerConnection(e.iceConfiguration))}catch(v){n.e(v)}finally{n.f()}e.inCall=!0,navigator.mediaDevices.getUserMedia(e.constraints).then((function(t){console.log("Got MediaStream:",t),e.videoStream=t,e.videoStream.getTracks().forEach((function(t){console.log("Adding tracks to peer connection!");var n,r=Object(q["a"])(e.pcs.values());try{for(r.s();!(n=r.n()).done;){var o=n.value;o.addTrack(t,e.videoStream)}}catch(v){r.e(v)}finally{r.f()}}))})).catch((function(e){console.error("Error accessing media devices.",e)})),a=Object(q["a"])(e.pcs.keys());try{for(s=function(){var t=c.value,n=new MediaStream,r={username:t,mediaStream:n};e.remoteVideoStreams.push(r),e.pcs.get(t).addEventListener("track",(function(e){console.log("Got a track from ",t),n.addTrack(e.track,n)}))},a.s();!(c=a.n()).done;)s()}catch(v){a.e(v)}finally{a.f()}console.log("pcs: ",e.pcs.values()),i=Object(q["a"])(e.pcs.values());try{for(i.s();!(u=i.n()).done;)l=u.value,console.log("pc: ",l),l.addEventListener("icecandidate",(function(t){t.candidate&&(console.log("ice c: ",t),e.$socket.client.emit("new-ice-candidate",{candidate:t.candidate,username:e.localUsername}))}))}catch(v){i.e(v)}finally{i.f()}d=Object(q["a"])(e.pcs.values());try{for(f=function(){var t=m.value;t.addEventListener("iceconnectionstatechange",(function(n){"connected"===t.iceConnectionState&&(console.log("Peers connected ",n),console.log("Remote streams: ",e.remoteVideoStreams))}))},d.s();!(m=d.n()).done;)f()}catch(v){d.e(v)}finally{d.f()}e.$socket.$subscribe("message",function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(n){var r,o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=n.message,o=n.username,!r.answer){t.next=11;break}return console.log("Got an answer from ",o),a=new RTCSessionDescription(r.answer),t.prev=4,t.next=7,e.pcs.get(o).setRemoteDescription(a);case 7:t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](4);case 11:case"end":return t.stop()}}),t,null,[[4,9]])})));return function(e){return t.apply(this,arguments)}}()),p={offerToReceiveAudio:!0,offerToReceiveVideo:!0},setTimeout(Object(g["a"])(regeneratorRuntime.mark((function t(){var n,r,o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=Object(q["a"])(e.pcs.values()),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=14;break}return o=r.value,console.log("Creating offer"),t.next=8,o.createOffer(p);case 8:return a=t.sent,t.next=11,o.setLocalDescription(a);case 11:e.$socket.client.emit("offer",{offer:a,username:e.localUsername});case 12:t.next=3;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](1),n.e(t.t0);case 19:return t.prev=19,n.f(),t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[1,16,19,22]])}))),1e3);case 15:case"end":return t.stop()}}),t)})))()}},sockets:{userJoinedRoom:function(e){console.log("User joined room",e)},userDisconnected:function(e){console.log("User left the room",e)},roomUsers:function(e){console.log("Updated users in the room",e),this.users=e},message:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.message,r=t.username,this.inCall){e.next=3;break}return e.abrupt("return");case 3:if(console.log(n,r),!n.offer){e.next=15;break}return console.log("Got an offer from ",r),this.pcs.get(r).setRemoteDescription(new RTCSessionDescription(n.offer)),e.next=9,this.pcs.get(r).createAnswer();case 9:return o=e.sent,e.next=12,this.pcs.get(r).setLocalDescription(o);case 12:this.$socket.client.emit("answer",{answer:o,username:this.localUsername}),e.next=26;break;case 15:if(!n.iceCandidate){e.next=26;break}return console.log("Got a new icecandidate through message ",r),e.prev=17,console.log("Addin ice candidate to peer connection"),e.next=21,this.pcs.get(r).addIceCandidate(n.iceCandidate);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e["catch"](17),console.error("Error adding received ice candidate",e.t0);case 26:case"end":return e.stop()}}),e,this,[[17,23]])})));function t(t){return e.apply(this,arguments)}return t}()},created:function(){this.room=this.$route.params.roomName,this.localUsername=this.$store.state.username,this.$socket.client.emit("join-room",{roomName:this.room,username:this.$store.state.username})},beforeDestroy:function(){console.log("Destroy room",this.room),this.$socket.client.emit("leave-room",this.room)}}),z=F,K=Object(i["a"])(z,N,B,!1,null,"287954f7",null),Q=K.exports;l()(K,{VBtn:y["a"],VIcon:C["a"],VList:R["a"],VListItem:S["a"],VListItemAction:j["a"],VListItemContent:O["a"],VListItemTitle:O["b"]}),r["a"].use(p["a"]);var W=[{path:"/",name:"Home",component:V},{path:"/video-chat",name:"VideoChatTest",component:J},{path:"/room/:roomName",name:"Room",component:Q},{path:"/about",name:"About",component:function(){return n.e("about~6a3582c1").then(n.bind(null,"f820"))}}],X=new p["a"]({routes:W}),Y=X,Z=n("2f62");r["a"].use(Z["a"]);var ee=new Z["a"].Store({state:{username:null},mutations:{setUsername:function(e,t){e.username=t}},actions:{setUsername:function(e,t){var n=e.commit;n("setUsername",t)}},modules:{}}),te=n("f309");r["a"].use(te["a"]);var ne=new te["a"]({}),re=n("f87c"),oe=Object(k["io"])("https://video-chat3.herokuapp.com/");r["a"].use(re["a"],oe,{store:ee}),r["a"].config.productionTip=!1,new r["a"]({router:Y,store:ee,vuetify:ne,render:function(e){return e(f)}}).$mount("#app")},"85ec":function(e,t,n){},b225:function(e,t,n){var r=n("c973").default;function o(e,t){return a.apply(this,arguments)}function a(){return a=r(regeneratorRuntime.mark((function e(t,n){var o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("Making call"),n.on("message",function(){var e=r(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n.answer){e.next=5;break}return console.log("Got an answer"),r=new RTCSessionDescription(n.answer),e.next=5,t.setRemoteDescription(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o={offerToReceiveAudio:!0,offerToReceiveVideo:!0},e.next=5,t.createOffer(o);case 5:return a=e.sent,e.next=8,t.setLocalDescription(a);case 8:n.emit("offer",a);case 9:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)}function c(e,t){t.on("message",function(){var n=r(regeneratorRuntime.mark((function n(r){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!r.offer){n.next=9;break}return console.log("Got an offer"),e.setRemoteDescription(new RTCSessionDescription(r.offer)),n.next=5,e.createAnswer();case 5:return o=n.sent,n.next=8,e.setLocalDescription(o);case 8:t.emit("answer",o);case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}function s(e,t){e.addEventListener("icecandidate",(function(e){console.log("Got an ice candidate: ",e.candidate),e.candidate&&t.emit("new-ice-candidate",e.candidate)}))}function i(e){e.addEventListener("iceconnectionstatechange",(function(t){console.log("Ice connection state changed: ",e.iceConnectionState),"connected"===e.iceConnectionState&&console.log("Peers connected",t)}))}function u(e,t){t.on("message",function(){var t=r(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n.iceCandidate){t.next=11;break}return console.log("Got and ice candidate through message"),t.prev=2,console.log("Addin ice candidate to peer connection"),t.next=6,e.addIceCandidate(n.iceCandidate);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](2),console.error("Error adding received ice candidate",t.t0);case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}())}function l(e,t){e.addEventListener("track",function(){var e=r(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("Got a track!!!"),t.addTrack(n.track,t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}n("96cf"),t.makeCall=o,t.onMessageOffer=c,t.onIceCandidate=s,t.oneIceConnectionChange=i,t.onMessageIceCandidate=u,t.onTrack=l}});
//# sourceMappingURL=app~d0ae3f07.3feff07f.js.map